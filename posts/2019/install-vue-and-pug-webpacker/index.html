<!DOCTYPE html>
<html lang="zh-TW"><head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Webpacker 安裝 Vue.js 與 pug - 愛雅小舖</title>
    <base href="http://ayaya.tw/">
    
    
    
    
    <link rel="stylesheet" href="http://ayaya.tw/css/main.min.d1a35de747f32f38def9b85df0ddc1ae0d95ca476bb14c10d484610ddcc1acda.css">
</head>
<body><header>
    <nav class="breadcrumb">
        
        <a href="/">/Home</a>
        
        <a href="/posts">/Posts</a>
        
        <a href="/donate">/Donate</a>
        
        <a href="/about">/About</a>
        
    </nav>
</header>
<div class="container">
<main id="single">
    <h1>Webpacker 安裝 Vue.js 與 pug</h1>
    <h2></h2>
    <section class="post-content">
        <p>最近有點想學點不同的東西, 因此想嘗試 <a href="https://vuejs.org/">vue.js</a>.</p>

<p>在 survey 的過程中發現了 <a href="https://pugjs.org/api/getting-started.html">pug</a> 這個東西, 和 ruby 的 slim 類似. 以前在寫 react 的過程中, 我認為最討厭的一點就是寫 jsx 了, 一不小心就會寫得很長, 再加上基本上都會寫在 <code>render</code> 方法中, 換行和縮排就會花費不少空間, 大概像這樣:</p>

<pre><code class="language-jsx">class MyComponent extends React.PureComponent {
  render () {
    return (
      &lt;div&gt;Hello&lt;/div&gt;
    )
  }
}
</code></pre>

<p>當然現在可以寫成純函數的形式的確是比較精簡了, 但還是不喜歡, 長期以來也都沒找到什麼解決辦法, 但是現在有了, 可以使用 <a href="https://github.com/pugjs/babel-plugin-transform-react-pug">babel-plugin-transform-react-pug</a> 在 <code>render</code> 的時候使用 pug 的語法, 應該能舒服許多.</p>

<p>不過本文的重點不是這個, 因為其實我是先想玩看看 vue.js, 接著看到 vue.js 中可以那樣寫才知道現在有這樣的東西, 所以還沒有嘗試 babel-plugin-transform-react-pug:</p>

<pre><code class="language-html">&lt;template lang=&quot;pug&quot;&gt;
#app
  p {{ message }}
&lt;/template&gt;

&lt;script&gt;
export default {
  data: function () {
    return {
      message: &quot;Hello Vue!&quot;
    }
  }
}
&lt;/script&gt;

&lt;style scoped&gt;
p {
  font-size: 2em;
  text-align: center;
}
&lt;/style&gt;
</code></pre>

<p>那麼首先先跑個</p>

<pre><code>rails webpacker:install:vue
</code></pre>

<p>它會提供所有基本的設定和一個簡單的範例 (類似上面的), 還會有一則訊息提醒你要記得修改 config/initializers/content_security_policy.rb .</p>

<p>但是這樣還不夠. 根據 packs/hello_vue.js 內所述, 如果有使用 Turbolinks, 需要再額外安裝:</p>

<pre><code>yarn add vue-turbolinks
</code></pre>

<p>然後照裡面所寫的, 將相關程式碼複製到 packs/application.js:</p>

<pre><code class="language-js">import TurbolinksAdapter from 'vue-turbolinks'
import Vue from 'vue/dist/vue.esm'
import App from '../app.vue'

Vue.use(TurbolinksAdapter)

document.addEventListener('turbolinks:load', () =&gt; {
  new Vue({ 
    el: '#hello',
    data: () =&gt; {
      return {
        message: &quot;Can you say hello?&quot;
      }
    },
    components: { App }
  })
})
</code></pre>

<p>然後在頁面中插入 <code>&lt;div id=&quot;hello&quot;&gt;&lt;app /&gt;&lt;/div&gt;</code> 就可以看到大大的 Hello Vue! 了.</p>

<p>打開 app.vue 以後會看到:</p>

<pre><code class="language-html">&lt;template&gt;
  &lt;div id=&quot;app&quot;&gt;
    &lt;p&gt;{{ message }}&lt;/p&gt;
  &lt;/div&gt;
&lt;/template&gt;
</code></pre>

<p>但是我想要:</p>

<pre><code class="language-html">&lt;template lang=&quot;pug&quot;&gt;
#app
  p {{ message }}
&lt;/template&gt;
</code></pre>

<p>但只是想要是沒有用的, 必須讓 webpack 認得 pug 並且編譯成該有的樣子才行, 因此來安裝這些套件:</p>

<pre><code>yarn add pug pug-plain-loader
</code></pre>

<p>然後建立一個 config/webpack/loaders/pug.js:</p>

<pre><code>module.exports = {
  test: /\.pug(\.erb)?$/,
  use: [{
    loader: 'pug-plain-loader'
  }]
}
</code></pre>

<p>並且修改 config/webpack/environment.js:</p>

<pre><code>const { environment } = require('@rails/webpacker')
const { VueLoaderPlugin } = require('vue-loader')
const vue = require('./loaders/vue')
const pug = require('./loaders/pug')

environment.plugins.prepend('VueLoaderPlugin', new VueLoaderPlugin())
environment.loaders.prepend('vue', vue)
environment.loaders.prepend('pug', pug)
module.exports = environment
</code></pre>

<p>這個時候內含 pug template 的 app.vue 就能正確的被編譯了.</p>

<p>再來有個要求是, 我希望能把檔案都放在 components 目錄中, 有新元件就自動載入命名註冊, 我的做法是, 建立一個 components/index.js:</p>

<pre><code class="language-js">import Vue from 'vue/dist/vue.esm'

const req = require.context('components', true, /\.vue$/)

function capitalize (word) {
  return word.charAt(0).toUpperCase() + word.substring(1)
}

function titleize (words) {
  return words.match(/\w+/g).map(capitalize).join('')
}

function constantize (filename) {
  return titleize(filename.match(/^(?:\.\/)?(.+)(?:\.vue$)$/)[1])
}

req.keys().map(key =&gt; Vue.component(constantize(key), req(key).default))
</code></pre>

<p>然後修改一下 packs/application.js:</p>

<pre><code class="language-js">import TurbolinksAdapter from 'vue-turbolinks'
import Vue from 'vue/dist/vue.esm'
import 'components'

Vue.use(TurbolinksAdapter)

document.addEventListener('turbolinks:load', () =&gt; {
  new Vue({ el: '#app' })
})
</code></pre>

<p>然後把 <code>#app</code> 放在 <code>body</code> 下, 這樣的設置看起來似乎一切都完美了&hellip;</p>

    </section>
</main>

        </div><footer>
    <ul class="lang-selector">
    
</ul>

    <span class="footer-text">Powered by <a href="https://gohugo.io/" target="_blank">Hugo</a></span>
</footer>

<script src="http://ayaya.tw/js/highlight.pack.13389e4e093fc0b3466287ead64c1f9fc3007d7703813a413de3f046ea09a346.js" integrity="sha256-EzieTgk/wLNGYofq1kwfn8MAfXcDgTpBPePwRuoJo0Y="></script>
<script>hljs.initHighlightingOnLoad();</script>
</body>
</html>
